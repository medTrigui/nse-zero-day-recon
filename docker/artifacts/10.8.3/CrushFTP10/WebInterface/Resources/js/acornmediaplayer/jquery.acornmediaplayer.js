/*
 * Acorn Media Player - jQuery plugin 1.8.1
 *
 * Copyright (C) 2013 Ionut Cristian Colceriu
 *
 * Licensed under the MIT:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * www.ghinda.net
 * contact@ghinda.net
 *
 * Contributors:
 * Steve Oldham - https://github.com/stephenoldham
 *
 *
 */

function parseSrt(e){var t=e.replace(/\r+/g,"");t=t.replace(/^\s+|\s+$/g,"");t=t.replace(/<[a-zA-Z\/][^>]*>/g,"");var n=[];var r=t.split("\n\n");for(var i=0;i<r.length;i=i+1){var s="";var o,u,a,f;s=r[i];f=s.split(/\n/);if(f[0].match(/^\d+$/)&&f[1].match(/\d+:\d+:\d+/)){var l=f[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(l){u=parseInt(l[1],10)*60*60+parseInt(l[2],10)*60+parseInt(l[3],10)+parseInt(l[4],10)/1e3;a=parseInt(l[5],10)*60*60+parseInt(l[6],10)*60+parseInt(l[7],10)+parseInt(l[8],10)/1e3}else{continue}o=f.slice(2).join("<br>")}else{continue}n.push({start:u,end:a,content:o})}return n}(function(e){e.fn.acornMediaPlayer=function(t){function i(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return false}}var n={theme:"access",nativeSliders:false,volumeSlider:"horizontal",captionsOn:false,tooltipsOn:true};t=e.extend(n,t);var r=function(){var e=new Date;return e.getTime()};var s="ontouchstart"in document.documentElement;var o=i?localStorage.getItem("acornvolume"):1;if(!o){o=1}var u=function(){var n={$self:e(this)};var i;var u;var a;var f;var l;var c=n.$self.attr("autoplay")?true:false;n.$self.attr("autoplay",false);var h={play:"Play",playTitle:"Start the playback",pause:"Pause",pauseTitle:"Pause the playback",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",fullscreenTitle:"Toggle fullscreen mode",volumeTitle:"Volume control",seekTitle:"Video seek control",captions:"Captions",captionsTitle:"Show captions",captionsChoose:"Choose caption",transcript:"Transcript",transcriptTitle:"Show transcript"};var p=e('<div class="acorn-player" role="application"></div>').addClass(t.theme);n.$self.attr("tabindex","0");n.id=n.$self.attr("id");if(!n.id){n.id="acorn"+r();n.$self.attr("id",n.id)}var d=n.$self.is("video")?'<button class="acorn-fullscreen-button" title="'+h.fullscreenTitle+'" aria-controls="'+n.id+'">'+h.fullscreen+"</button>":"";var v=t.tooltipsOn?'<div class="acorn-tooltip"><div>':"";var m='<div class="acorn-controls">'+'<button class="acorn-play-button" title="'+h.playTitle+'" aria-controls="'+n.id+'">'+h.play+"</button>"+'<input type="range" class="acorn-seek-slider" title="'+h.seekTitle+'" value="0" min="0" max="150" step="0.1" aria-controls="'+n.id+'"/>'+'<span class="acorn-timer">00:00</span>'+'<div class="acorn-volume-box">'+'<button class="acorn-volume-button" title="'+h.mute+'" aria-controls="'+n.id+'">'+h.mute+"</button>"+'<input type="range" class="acorn-volume-slider" title="'+h.volumeTitle+'" value="1" min="0" max="1" step="0.05" aria-controls="'+n.id+'"/>'+"</div>"+d+'<button class="acorn-caption-button" title="'+h.captionsTitle+'"  aria-controls="'+n.id+'">'+h.captions+"</button>"+'<div class="acorn-caption-selector"></div>'+'<button class="acorn-transcript-button" title="'+h.transcriptTitle+'">'+h.transcript+"</button>"+"</div>"+v;var g='<div class="acorn-caption"></div>';var y='<div class="acorn-transcript" role="region" aria-live="assertive"></div>';n.$self.after(p);p[0].appendChild(n.$self[0].cloneNode(true));n.$self.remove();n.$self=p.find("video, audio");n.$self.after(m).after('<div class="loading-media"></div>');n.$container=n.$self.parent(".acorn-player");n.$controls=e(".acorn-controls",n.$container);n.$playBtn=e(".acorn-play-button",n.$container);n.$seek=e(".acorn-seek-slider",n.$container);n.$timer=e(".acorn-timer",n.$container);n.$volume=e(".acorn-volume-slider",n.$container);n.$volumeBtn=e(".acorn-volume-button",n.$container);n.$fullscreenBtn=e(".acorn-fullscreen-button",n.$container);n.$tooltip=e(".acorn-tooltip",n.$container);n.$controls.after(g);n.$container.after(y);n.$transcript=n.$container.next(".acorn-transcript");n.$transcriptBtn=e(".acorn-transcript-button",n.$container);n.$caption=e(".acorn-caption",n.$container);n.$captionBtn=e(".acorn-caption-button",n.$container);n.$captionSelector=e(".acorn-caption-selector",n.$container);n.$self.attr("data-width",n.$self.width());n.$self.attr("data-height",n.$self.height());var b=function(e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60);var n=Math.floor(e-t*60)<10?"0"+Math.floor(e-t*60):Math.floor(e-t*60);return t+":"+n};var w=function(){if(!n.$self.prop("paused")){n.$self.trigger("pause")}else{n.$self[0].play()}};var E=function(){n.$playBtn.text(h.pause).attr("title",h.pauseTitle);n.$playBtn.addClass("acorn-paused-button");if(!i)p.addClass("show-loading")};var S=function(){n.$playBtn.text(h.play).attr("title",h.playTitle);n.$playBtn.removeClass("acorn-paused-button")};var x=function(){var e=n.$self.prop("currentTime");n.$timer.text(b(e));if(!u){if(t.nativeSliders){n.$seek.val(e)}else{n.$seek.slider("value",e)}}if(l){W()}};var T=function(e){var t=Math.floor(e/60)<10?""+Math.floor(e/60):Math.floor(e/60);var n=Math.floor(e-t*60)<10?""+Math.floor(e-t*60):Math.floor(e-t*60);var r;var i="minutes";var s="seconds";if(t==1){min="minute"}if(n==1){e="second"}if(t===0){r=n+" "+s}else{r=t+" "+i+" "+n+" "+s}return r};var N=function(){n.$captionBtn.trigger("blur")};var C=function(e,r){if(!n.$self.prop("paused")){a=true}n.$self.trigger("pause");u=true;var i;if(t.nativeSliders){i=n.$seek.val()}else{i=r.value}n.$self[0].currentTime=i;N()};var k=function(t,r){if(a){n.$self.trigger("play");a=false}u=false;if(!r)return;var i=e(r.handle);i.attr("aria-valuenow",parseInt(r.value,10));i.attr("aria-valuetext",T(r.value))};var L=function(e,t){var n={role:"slider","aria-valuenow":parseInt(t.value,10),"aria-valuemin":parseInt(t.min,10),"aria-valuemax":parseInt(t.max,10),"aria-valuetext":t.valuetext,tabindex:"0"};e.attr(n)};var A=function(){var t=n.$seek.attr("class");var r='<div class="'+t+'" title="'+h.seekTitle+'"></div>';n.$seek.after(r).remove();n.$seek=e("."+t,n.$container);var i='<div class="ui-slider-range acorn-buffer"></div>';n.$seek.append(i);n.$buffer=e(".acorn-buffer",n.$container);var s={value:0,step:1,orientation:"horizontal",range:"min",min:0,max:100};n.$seek.slider(s)};var O=function(){var r=n.$self[0].duration;if(t.nativeSliders){n.$seek.attr("max",r);n.$seek.bind("change",C);n.$seek.bind("mousedown",C);n.$seek.bind("mouseup",k)}else{var i={value:0,step:1,orientation:"horizontal",range:"min",min:0,max:r,slide:C,stop:k};n.$seek.slider("option",i);i.valuetext=T(i.value);L(n.$seek.find(".ui-slider-handle"),i);e(".ui-slider-handle",n.$seek).click(N);n.$self.bind("progress",M)}p.removeClass("show-loading")};var M=function(e){var t=parseInt(n.$self.prop("duration"),10);var r=this.buffered;if(r&&r.length){var i=parseInt(this.buffered.end(0)-this.buffered.start(0),10);var s=i*100/t;n.$buffer.css("width",s+"%")}};var _=function(e,t){o=t.value;localStorage.setItem("acornvolume",o);if(n.$self.prop("muted")){n.$self.prop("muted",false);n.$volumeBtn.removeClass("acorn-volume-mute");n.$volumeBtn.text(h.mute).attr("title",h.mute)}n.$self.prop("volume",o);n.$volume.$handle.attr("aria-valuenow",Math.round(o*100));n.$volume.$handle.attr("aria-valuetext",Math.round(o*100)+" percent");N()};var D=function(){if(n.$self.prop("muted")===true){n.$self.prop("muted",false);if(t.nativeSliders){n.$volume.val(o)}else{n.$volume.slider("value",o)}n.$volumeBtn.removeClass("acorn-volume-mute");n.$volumeBtn.text(h.mute).attr("title",h.mute)}else{n.$self.prop("muted",true);if(t.nativeSliders){n.$volume.val("0")}else{n.$volume.slider("value","0")}n.$volumeBtn.addClass("acorn-volume-mute");n.$volumeBtn.text(h.unmute).attr("title",h.unmute)}};var P=function(){if(t.nativeSliders){n.$volume.bind("change",function(){n.$self.prop("muted",false);o=n.$volume.val();n.$self.prop("volume",o)})}else{var r=n.$volume.attr("class");var i='<div class="'+r+'" title="'+h.volumeTitle+'"></div>';n.$volume.after(i).remove();n.$volume=e("."+r,n.$container);var s={value:o,orientation:t.volumeSlider,range:"min",max:1,min:0,step:.1,animate:true,slide:_};n.$volume.slider(s);n.$volume.$handle=n.$volume.find(".ui-slider-handle");s.max=100;s.value=s.value*100;s.valuetext=s.value+" percent";L(n.$volume.$handle,s);e(".ui-slider-handle",n.$volume).click(N)}n.$volumeBtn.click(D)};var H=function(){n.$self.attr({width:e(window).width(),height:e(window).height()})};var B=function(){if(f){if(n.$self[0].cancelFullScreen){n.$self[0].cancelFullScreen()}else if(n.$self[0].webkitCancelFullScreen){n.$self[0].webkitCancelFullScreen()}else if(n.$self[0].mozCancelFullScreen){n.$self[0].mozCancelFullScreen()}else{e("body").css("overflow","auto");var t=n.$self.attr("data-width");var r=n.$self.attr("data-height");n.$self.removeClass("fullscreen-video").attr({width:t,height:r});e(window).unbind("resize");n.$controls.removeClass("fullscreen-controls")}f=false}else{if(n.$self[0].requestFullscreen){n.$self[0].requestFullscreen()}else if(n.$self[0].webkitRequestFullscreen){n.$self[0].webkitRequestFullscreen()}else if(n.$self[0].mozRequestFullScreen){n.$self[0].mozRequestFullScreen()}else{e("body").css("overflow","hidden");n.$self.addClass("fullscreen-video").attr({width:e(window).width(),height:e(window).height()});e(window).resize(H);n.$controls.addClass("fullscreen-controls")}f=true}};var j=function(t){if(e(this).attr("title")){n.$tooltip.html(e(this).attr("title")).addClass("show-tooltip")}};var F=function(t){if(e(this).attr("title")){n.$tooltip.removeClass("show-tooltip")}};var I="acorn-caption-active";var q="acorn-caption-loading";var R="acorn-transcript-active";var U="acornCaptions"+r();var z=function(){captions="";n.$caption.hide();activeCaptions=false;n.$transcriptBtn.removeClass(R).hide();n.$transcript.hide();n.$captionBtn.removeClass(I)};var W=function(){var e=n.$self[0].currentTime,t="",r,i=captions.length;for(r=0;r<i;r++){if(e>=captions[r].start&&e<=captions[r].end){t=captions[r].content;break}}n.$caption.html(t)};var X=function(){var t=function(){var e=n.$captionBtn.offset();var t=e.top-n.$captionSelector.outerHeight(true);var r=e.left-(n.$captionSelector.outerWidth(true)-n.$captionBtn.outerWidth(true))/2;var i=n.$controls.offset();r=r-i.left;t=t-i.top;n.$captionSelector.css({top:t,left:r})};n.$fullscreenBtn.click(t);e(window).resize(function(){t()});t();var r;var i=function(){if(r){clearTimeout(r)}n.$captionSelector.show()};var s=function(){r=setTimeout(function(){n.$captionSelector.hide()},200)};n.$captionBtn.click(function(){e(this).focus()});n.$captionBtn.bind("focus",i);n.$captionBtn.bind("blur",s);e("input[name="+U+"]",n.$container).bind("focus",i);e("input[name="+U+"]",n.$container).bind("blur",s);n.$captionSelector.attr("tabindex","-1");n.$captionSelector.bind("focus",i);n.$captionSelector.bind("blur",s)};var V=function(t){n.$captionBtn.addClass(q);e.ajax({url:t,success:function(t){captions=parseSrt(t);n.$transcriptBtn.show();var r="";e(captions).each(function(){r+='<span data-begin="'+parseInt(this.start,10)+'" data-end='+parseInt(this.end,10)+">"+this.content.replace("'","")+"</span>"});n.$transcript.html(r);n.$caption.show();l=true;if(n.$self.prop("paused")){W()}n.$captionBtn.addClass(I).removeClass(q)},error:function(){z();if(console){console.log("Error loading captions")}}})};var J=function(){if(e(this).hasClass(R)){n.$transcript.hide()}else{n.$transcript.show()}e(this).toggleClass(R)};var K=function(){n.$track=e("track",n.$self);if(n.$track.length){n.$captionBtn.show()}if(n.$track.length>1){n.$captionBtn.attr("title",h.captionsChoose);var r='<ul><li><label><input type="radio" name="'+U+'" checked="true" />None</label></li>';n.$track.each(function(){var t=e(this).attr("src");r+='<li><label><input type="radio" name="'+U+'" data-url="'+e(this).attr("src")+'" />'+e(this).attr("label")+"</label></li>"});r+="</ul>";n.$captionSelector.html(r);var i=function(){var t=e(this).attr("data-url");if(t){V(t)}else{z()}};e("input[name="+U+"]",n.$container).change(i);X();var s=n.$track.first().attr("src");if(t.captionsOn){V(s);e("input[name="+U+"]",n.$container).removeAttr("checked");e("input[name="+U+"]:eq(1)",n.$container).prop("checked","true")}}else if(n.$track.length){var o=n.$track.attr("src");n.$captionBtn.bind("click",function(){if(e(this).hasClass(I)){z()}else{V(o)}e(this).toggleClass(I)});if(t.captionsOn)V(o)}n.$transcriptBtn.bind("click",J)};var Q=function(){n.$playBtn.bind(s?"touchstart":"click",w);n.$self.bind(s?"touchstart":"click",w);n.$self.bind("play",E);n.$self.bind("pause",S);n.$self.bind("ended",S);n.$self.bind("timeupdate",x);n.$fullscreenBtn.click(B);if(t.tooltipsOn){n.$controls.find("button").mouseover(j).mouseout(F)}P();if(!t.nativeSliders)A();n.$self.bind("loadedmetadata",function(){var e=window.setInterval(function(){if(n.$self[0].readyState>0){i=true;O();clearInterval(e)}},500);K()});if(c)n.$self.trigger("play");n.$self.removeAttr("controls");if(n.$self.is("audio")){n.$container.addClass("audio-player")}}()};return this.each(u)}})(jQuery)